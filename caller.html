<!-- caller.html (FINAL) -->
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Customer Service BWX (Admin)</title>

  <!-- Material Components -->
  <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet" />
  <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />

  <!-- App styles -->
  <link rel="stylesheet" href="./main.css" />

  <!-- Slide panel styles (bisa dipindah ke main.css jika mau) -->
  <style>
    :root{
      --panel-bg:#0d1418;
      --panel-text:#e0e0e0;
      --panel-muted:#9aa0a6;
      --panel-accent:#f44336;
      --panel-width: 320px;
      --panel-shadow: 0 10px 30px rgba(0,0,0,.45);
    }
    /* ===== Slide Panel (kanan) ===== */
    .slide-panel{
      position: fixed; top:0; right:0; height:100vh;
      width: var(--panel-width); max-width: 85vw;
      background: var(--panel-bg); color: var(--panel-text);
      transform: translateX(100%); transition: transform .28s ease;
      z-index: 1000; display:flex; flex-direction:column;
      box-shadow: var(--panel-shadow);
      touch-action: pan-y;
    }
    .slide-panel.open{ transform: translateX(0); }

    .slide-header{
      display:flex; align-items:center; gap:10px;
      padding:14px 14px; border-bottom:1px solid rgba(255,255,255,.08);
      font-weight:600;
    }
    .slide-body{ padding:16px; overflow:auto; }

    .row{ margin-bottom:14px; }
    .status{ font-size:15px; }
    .last-checked{ font-size:12px; color: var(--panel-muted); }

    .spinner{
      margin-top:12px; display:none;
      justify-content:center; align-items:center; gap:8px;
    }
    .dot{ width:8px; height:8px; border-radius:50%;
      background: var(--panel-accent); animation: bounce 1.2s infinite ease-in-out; }
    .dot:nth-child(2){ animation-delay:.2s }
    .dot:nth-child(3){ animation-delay:.4s }
    @keyframes bounce{ 0%,80%,100%{transform:scale(0)} 40%{transform:scale(1)} }

    .panel-actions{ display:flex; gap:8px; margin-top:8px; }
    .btn-danger{
      background: var(--panel-accent); color:#fff; border:none;
      padding:10px 14px; border-radius:10px; font-weight:600; cursor:pointer;
    }
    .btn-danger:disabled{ opacity:.7; cursor:not-allowed; }
    .note{ font-size:12px; color: var(--panel-muted); margin-top:10px; }

    /* Handle/Tab untuk buka-tutup */
    .slide-handle{
      position: fixed; top: 50%; right: 0; transform: translateY(-50%);
      z-index: 1001;
      width: 36px; height: 72px; border-radius: 12px 0 0 12px;
      background: #111b21; color:#e9edef; display:flex; align-items:center; justify-content:center;
      border-left: 1px solid rgba(255,255,255,.08);
      border-top: 1px solid rgba(255,255,255,.08);
      border-bottom: 1px solid rgba(255,255,255,.08);
      box-shadow: 0 8px 20px rgba(0,0,0,.35);
      cursor: pointer; user-select:none;
    }
    .slide-handle .material-icons{ font-size: 22px; }

    /* Backdrop saat panel terbuka */
    .panel-backdrop{
      position: fixed; inset:0; background: rgba(0,0,0,.3);
      opacity:0; visibility:hidden; transition: opacity .2s ease;
      z-index: 999;
    }
    .panel-backdrop.show{ opacity:1; visibility:visible; }

    /* Minor tweak agar watermark tidak ketutup handle */
    #watermark-logo{ pointer-events: none; }
  </style>
</head>
<body>
  <div id="calleeNameLabel" style="display:none;">Nama Callee</div>

  <div id="buttons">
    <button class="mdc-button mdc-button--raised" id="startCallBtn" style="display:none;">
      <i class="material-icons mdc-button__icon" aria-hidden="true">call</i>
      <span class="mdc-button__label">Mulai Panggilan</span>
    </button>
    <button class="mdc-button mdc-button--raised" disabled id="hangupBtn" title="Akhiri panggilan">
      <i class="material-icons mdc-button__icon" aria-hidden="true">call_end</i>
    </button>
  </div>

  <div><span id="currentRoom"></span></div>

  <div id="videos">
    <video id="localVideo" muted autoplay playsinline></video>
    <video id="remoteVideo" autoplay playsinline></video>
    <img id="watermark-logo" src="https://injourney.id/assets/airports-business-logo-bK5fIp14.png" alt="Logo InJourney" />
  </div>

  <div id="loading" class="loading-overlay" style="display:none;">
    <div class="loading-spinner"></div>
    <div class="loading-text">Connecting...</div>
  </div>

  <!-- ===== Slide Handle & Backdrop ===== -->
  <div class="slide-handle" id="slideHandle" title="Status Koneksi">
    <span class="material-icons" id="handleIcon">chevron_left</span>
  </div>
  <div class="panel-backdrop" id="panelBackdrop"></div>

  <!-- ===== Slide Panel (Kanan) ===== -->
  <aside class="slide-panel" id="slidePanel" aria-hidden="true">
    <div class="slide-header">
      <img src="https://injourney.id/assets/airports-business-logo-bK5fIp14.png" alt="Logo" style="width:28px; opacity:.9" />
      <span>Status Koneksi</span>
      <button class="mdc-icon-button" id="closePanelBtn" aria-label="Tutup panel" style="margin-left:auto;">
        <i class="material-icons mdc-icon-button__icon">close</i>
      </button>
    </div>
    <div class="slide-body">
      <div class="row status" id="statusText">Memeriksa status koneksiâ€¦</div>
      <div class="row last-checked" id="lastCheckedText">Terakhir diperiksa: -</div>

      <div class="spinner" id="spinnerDots" aria-hidden="true">
        <div class="dot"></div><div class="dot"></div><div class="dot"></div>
      </div>

      <div class="panel-actions">
        <button id="closeRoomBtn" class="btn-danger">Tutup Koneksi</button>
      </div>
      <div class="note">Room & kandidat ICE akan dihapus dari Firestore.</div>
    </div>
  </aside>

  <!-- (Opsional) set ROOM_ID dinamis via query ?room=xxx -->
  <!-- <script>window.ROOM_ID = new URLSearchParams(location.search).get('room') || 'cs-room';</script> -->

  <!-- WebRTC + Panel logic (versi gabungan) -->
  <script type="module" src="./app.js"></script>
</body>
</html>

